<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>日语形态练习</title>
    <link rel="stylesheet" href="style.css?v=__APP_VERSION__">
    <link rel="manifest" href="manifest.json?v=__APP_VERSION__">
</head>
<body>
    <div class="app">
        <!-- 主要内容区域 -->
        <main class="main-content">
            <!-- 学习页面 -->
            <div id="learn" class="page active">
                <div class="page-header">
                    <h1>日语形态练习</h1>
                    <div class="user-info">
                        <span id="user-code">加载中...</span>
                    </div>
                </div>
                
                <!-- 模块选择 -->
                <div class="module-selector">
                    <button class="module-btn active" data-module="verb">
                        <div class="module-icon">動</div>
                        <div class="module-text">
                            <div class="module-title">动词变形</div>
                            <div class="module-desc">ます形・て形・否定形等</div>
                        </div>
                    </button>
                    <button class="module-btn" data-module="adj">
                        <div class="module-icon">形</div>
                        <div class="module-text">
                            <div class="module-title">形容词变形</div>
                            <div class="module-desc">i形容词・na形容词</div>
                        </div>
                    </button>
                    <button class="module-btn" data-module="plain">
                        <div class="module-icon">簡</div>
                        <div class="module-text">
                            <div class="module-title">简体形</div>
                            <div class="module-desc">简体形变化练习</div>
                        </div>
                    </button>
                    <button class="module-btn" data-module="polite">
                        <div class="module-icon">敬</div>
                        <div class="module-text">
                            <div class="module-title">敬体形</div>
                            <div class="module-desc">敬语敬体巩固</div>
                        </div>
                    </button>
                </div>
                
                <!-- 形态选择 -->
                <div class="form-selector">
                    <div class="form-chips" id="form-chips">
                        <!-- 动态生成 -->
                    </div>
                </div>
                
                <!-- 练习模式切换 -->
                <div class="mode-toggle">
                    <button class="mode-btn active" data-mode="flashcard">闪卡模式</button>
                    <button class="mode-btn" data-mode="quiz">测验模式</button>
                </div>
                
                <!-- 测验卡片 -->
                <div class="quiz-card" id="quiz-card" style="display: none;">
                    <div class="card-header">
                        <div class="word-info">
                            <div class="word-main" id="word-main">読む</div>
                            <div class="word-reading" id="word-reading">よむ</div>
                            <div class="word-meaning" id="word-meaning">读</div>
                        </div>
                        <div class="target-form" id="target-form">て形</div>
                    </div>
                    
                    <div class="input-section">
                        <input type="text" id="answer-input" placeholder="请输入答案" autocomplete="off">
                        <button class="submit-btn" id="submit-btn">提交</button>
                    </div>
                    
                    <div class="result-section" id="result-section" style="display: none;">
                        <div class="result-status" id="result-status"></div>
                        <div class="correct-answer" id="correct-answer"></div>
                        <div class="explanation" id="explanation"></div>
                        <button class="next-btn" id="next-btn">下一题</button>
                    </div>
                </div>
                
                <!-- 闪卡 -->
                <div class="flashcard" id="flashcard" style="display: none;">
                    <div class="card-front" id="card-front">
                        <div class="word-info">
                            <div class="word-main" id="fc-word-main">読む</div>
                            <div class="word-reading" id="fc-word-reading">よむ</div>
                            <div class="word-meaning" id="fc-word-meaning">读</div>
                        </div>
                        <div class="target-form" id="fc-target-form">て形</div>
                        <button class="flip-btn" id="flip-btn">显示答案</button>
                    </div>
                    
                    <div class="card-back" id="card-back" style="display: none;">
                        <div class="answer-display" id="fc-answer">読んで</div>
                        <div class="explanation" id="fc-explanation">む结尾动词的て形变化</div>
                        
                        <div class="feedback-buttons">
                            <button class="feedback-btn again" data-feedback="again">Again</button>
                            <button class="feedback-btn hard" data-feedback="hard">Hard</button>
                            <button class="feedback-btn good" data-feedback="good">Good</button>
                            <button class="feedback-btn easy" data-feedback="easy">Easy</button>
                        </div>
                    </div>
                </div>
                
                <!-- 开始按钮 -->
                <div class="start-section">
                    <button class="start-btn" id="start-btn">开始练习</button>
                </div>
            </div>
            
            <!-- AI 日语讲解页面 -->
            <div id="ai" class="page">
                <div class="page-header">
                    <h1>AI 日语讲解</h1>
                    <p class="page-desc">与 AI 以聊天方式互动，支持文字与图片提问。</p>
                </div>

                <section id="ai-assistant-view" class="ai-chat">
                    <div class="ai-chat-messages" id="ai-chat-messages">
                        <div class="ai-message ai-bot">
                            <div class="ai-bubble">
                                こんにちは！输入日文或中文句子，也可以上传教材/练习照片，我会帮你识别并讲解语法。
                            </div>
                        </div>
                    </div>

                    <div class="ai-input-panel">
                        <div class="ai-input-field">
                            <textarea
                                id="ai-chat-text"
                                placeholder="输入问题或句子..."
                                maxlength="1000"
                                data-max-length="1000"
                            ></textarea>
                        </div>
                        <div id="ai-selected-file" class="ai-selected-file hidden">
                            <img id="ai-image-preview" alt="预览">
                            <span id="ai-image-name"></span>
                            <button type="button" id="ai-remove-image" class="link-button">移除</button>
                        </div>
                        <div class="ai-input-actions">
                            <label for="ai-chat-file" class="ai-upload-btn">📷</label>
                            <input type="file" id="ai-chat-file" accept="image/*" hidden>
                            <button id="ai-chat-send" class="ai-submit-btn">发送</button>
                        </div>
                        <div id="ai-message" class="ai-message"></div>
                    </div>
                </section>
            </div>

            <!-- 进度页面 -->
            <div id="progress" class="page">
                <div class="page-header">
                    <h1>学习进度</h1>
                </div>
                
                <!-- 新的三层结构 -->
                <div class="progress-container">
                    
                    <!-- 第一层：今日概览 -->
                    <div class="today-overview-section">
                        <h2>今日概览</h2>
                        
                        <!-- 今日目标进度 -->
                        <div class="today-progress">
                            <div class="progress-card">
                                <div class="progress-header">
                                    <span class="progress-title">新学进度</span>
                                    <span class="progress-count" id="new-progress">0/10</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="new-progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div class="progress-card">
                                <div class="progress-header">
                                    <span class="progress-title">复习进度</span>
                                    <span class="progress-count" id="review-progress">0/50</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="review-progress-fill" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 今日统计卡片 -->
                        <div class="today-stats">
                            <div class="stat-card">
                                <div class="stat-icon">📚</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="study-time-today">0分钟</div>
                                    <div class="stat-label">今日学习时间</div>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon">🔥</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="study-streak">0天</div>
                                    <div class="stat-label">学习连击</div>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-icon">⏰</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="due-total">0</div>
                                    <div class="stat-label">待复习总数</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 第二层：模式对比 -->
                    <div class="mode-comparison-section">
                        <h2>模式对比</h2>
                        
                        <!-- 模块选择器 -->
                        <div class="module-selector">
                            <button class="module-btn active" data-module="all">全部</button>
                            <button class="module-btn" data-module="vrb">动词</button>
                            <button class="module-btn" data-module="adj">形容词</button>
                            <button class="module-btn" data-module="pln">简体形</button>
                            <button class="module-btn" data-module="pol">敬体形</button>
                        </div>
                        
                        <!-- 模式对比图表 -->
                        <div class="mode-comparison-charts">
                            <div class="comparison-card">
                                <h3>测验模式</h3>
                                <div class="mode-stats" id="quiz-mode-stats">
                                    <div class="mode-stat">
                                        <span class="stat-label">总题目</span>
                                        <span class="stat-value" id="quiz-total">0</span>
                                    </div>
                                    <div class="mode-stat">
                                        <span class="stat-label">正确率</span>
                                        <span class="stat-value" id="quiz-accuracy">0%</span>
                                    </div>
                                    <div class="mode-stat">
                                        <span class="stat-label">平均熟练度</span>
                                        <span class="stat-value" id="quiz-streak">0</span>
                                    </div>
                                    <div class="mode-stat">
                                        <span class="stat-label">已掌握</span>
                                        <span class="stat-value" id="quiz-mastered">0</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="comparison-card">
                                <h3>闪卡模式</h3>
                                <div class="mode-stats" id="flashcard-mode-stats">
                                    <div class="mode-stat">
                                        <span class="stat-label">总题目</span>
                                        <span class="stat-value" id="flashcard-total">0</span>
                                    </div>
                                    <div class="mode-stat">
                                        <span class="stat-label">平均熟练度</span>
                                        <span class="stat-value" id="flashcard-accuracy">0%</span>
                                    </div>
                                    <div class="mode-stat">
                                        <span class="stat-label">平均连击数</span>
                                        <span class="stat-value" id="flashcard-streak">0</span>
                                    </div>
                                    <div class="mode-stat">
                                        <span class="stat-label">已掌握</span>
                                        <span class="stat-value" id="flashcard-mastered">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 模式推荐 -->
                        <div class="mode-recommendation" id="mode-recommendation">
                            <!-- 动态生成推荐内容 -->
                        </div>
                    </div>
                    
                    <!-- 第三层：学习洞察 -->
                    <div class="learning-insights-section">
                        <h2>学习洞察</h2>
                        
                        <!-- 洞察标签页 -->
                        <div class="insights-tabs">
                            <button class="insight-tab-btn active" data-tab="trends">7天趋势</button>
                            <button class="insight-tab-btn" data-tab="weaknesses">薄弱环节</button>
                            <button class="insight-tab-btn" data-tab="suggestions">智能建议</button>
                        </div>
                        
                        <!-- 7天趋势 -->
                        <div id="trends-insight" class="insight-content active">
                            <div class="trend-chart-container">
                                <canvas id="weekly-trend-chart" width="500" height="280"></canvas>
                            </div>
                            <div class="trend-summary" id="trend-summary">
                                <!-- 动态生成趋势总结 -->
                            </div>
                        </div>
                        
                        <!-- 薄弱环节 -->
                        <div id="weaknesses-insight" class="insight-content">
                            <div class="weakness-list" id="weakness-list">
                                <!-- 动态生成薄弱环节 -->
                            </div>
                        </div>
                        
                        <!-- 智能建议 -->
                        <div id="suggestions-insight" class="insight-content">
                            <div class="recommendations-container">
                                <!-- 学习目标推荐 -->
                                <div class="recommendation-section" id="goals-recommendations">
                                    <h4>学习目标建议</h4>
                                    <div class="recommendation-cards" id="goals-cards">
                                        <!-- 动态生成目标推荐卡片 -->
                                    </div>
                                </div>
                                
                                <!-- 学习模式推荐 -->
                                <div class="recommendation-section" id="modes-recommendations">
                                    <h4>学习模式建议</h4>
                                    <div class="recommendation-cards" id="modes-cards">
                                        <!-- 动态生成模式推荐卡片 -->
                                    </div>
                                </div>
                                
                                <!-- 学习时间推荐 -->
                                <div class="recommendation-section" id="schedule-recommendations">
                                    <h4>最佳学习时间</h4>
                                    <div class="recommendation-cards" id="schedule-cards">
                                        <!-- 动态生成时间推荐卡片 -->
                                    </div>
                                </div>
                                
                                <!-- 重点关注区域 -->
                                <div class="recommendation-section" id="focus-recommendations">
                                    <h4>重点关注</h4>
                                    <div class="recommendation-cards" id="focus-cards">
                                        <!-- 动态生成重点关注卡片 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 设置页面 -->
            <div id="settings" class="page">
                <div class="page-header">
                    <h1>设置</h1>
                </div>
                
                <div class="settings-section">
                    <h3>账户信息</h3>
                    <div class="setting-item">
                        <label>邮箱地址</label>
                        <div class="user-email-section">
                            <span id="user-email-display">未登录</span>
                        </div>
                        <div class="setting-desc">您的登录邮箱地址</div>
                    </div>
                    
                    <div class="setting-item">
                        <button class="logout-btn" id="logout-btn">退出登录</button>
                        <div class="setting-desc">退出当前账户，返回登录页面</div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>学习设置</h3>
                    <div class="setting-item">
                        <label class="switch-label">
                            <input type="checkbox" id="due-only-toggle">
                            <span class="switch"></span>
                            只显示到期题目
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label class="switch-label">
                            <input type="checkbox" id="show-explain-toggle">
                            <span class="switch"></span>
                            显示变形规则说明
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label>每日新学习目标</label>
                        <div class="goal-setting">
                            <input type="number" id="daily-goal-input" min="1" max="50" value="10">
                            <span class="goal-unit">个新词汇</span>
                        </div>
                        <div class="setting-desc">设置每天学习新词汇的目标数量</div>
                        <div class="goal-progress" id="goal-progress">
                            <div class="progress-text">今日进度：<span id="today-progress">0</span>/<span id="today-goal">10</span></div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="settings-new-progress-fill"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <label>每日复习目标</label>
                        <div class="goal-setting">
                            <input type="number" id="daily-review-goal-input" min="1" max="100" value="20">
                            <span class="goal-unit">个复习题目</span>
                        </div>
                        <div class="setting-desc">设置每天复习已学词汇的目标数量</div>
                        <div class="goal-progress" id="review-goal-progress">
                            <div class="progress-text">今日复习进度：<span id="today-review-progress">0</span>/<span id="today-review-goal">20</span></div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="settings-review-progress-fill"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>启用的变形</h3>
                    <div class="form-toggles" id="form-toggles">
                        <!-- 动态生成 -->
                    </div>
                </div>
                
                <!-- 版权声明 -->
                <div class="copyright-section">
                    <div class="copyright-text">
                        <p>&copy; 2025 日语形态练习应用</p>
                        <p>基于 MIT 许可证开源</p>
                        <p>版本 <span id="app-version">1.0.2</span></p>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- 底部导航 -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-page="learn">
                <div class="nav-icon">📚</div>
                <div class="nav-label">学习</div>
            </button>
            <button class="nav-item" data-page="ai">
                <div class="nav-icon">🤖</div>
                <div class="nav-label">AI讲解</div>
            </button>
            <button class="nav-item" data-page="progress">
                <div class="nav-icon">📊</div>
                <div class="nav-label">进度</div>
            </button>
            <button class="nav-item" data-page="settings">
                <div class="nav-icon">⚙️</div>
                <div class="nav-label">设置</div>
            </button>
        </nav>
    </div>
    
    <!-- 加载提示 -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text">加载中...</div>
    </div>
    
    <!-- 提示消息 -->
    <div class="toast" id="toast"></div>
    
    <!-- 应用更新提示 -->
    <div class="update-modal" id="updateModal">
        <div class="update-content">
            <div class="update-icon">🔄</div>
            <h3>发现新版本</h3>
            <p>有新版本可用，建议立即更新以获得最佳体验。</p>
            <div class="update-actions">
                <button class="btn-secondary" id="updateLater">稍后提醒</button>
                <button class="btn-primary" id="updateNow">立即更新</button>
            </div>
        </div>
    </div>
    
    <!-- 加载模块化脚本 -->
    <script src="js/modules.js?v=__APP_VERSION__"></script>

    <!-- 加载主应用 -->
    <script src="app.js?v=__APP_VERSION__"></script>
</body>
</html>
